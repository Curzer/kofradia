<?php

$unknown_img = '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';

function error($msg)
{
	header("HTTP/1.1 406 Not Acceptable");
	die($msg);
}

// mangler ff id?
if (!isset($_GET['ff_id']))
{
	error("Mangler ff ID.");
}

// sjekk ff id
$ff_id = intval($_GET['ff_id']);
if ($ff_id != $_GET['ff_id'] || $ff_id == 0)
{
	error("Ugyldig ff ID.");
}

require "../../app/essentials.php";
global $_base;

// sÃ¸rg for at den ikke cacher
header("Expires: Mon, 18 Jul 2005 00:00:00 GMT");
header("Cache-Control: no-store, no-cache, must-revalidate"); // HTTP/1.1
header("Cache-Control: post-check=0, pre-check=0", false);// HTTP/1.1
header("Pragma: no-cache"); // HTTP/1.0

// skal vi vise en gammel logo?
if (isset($_GET['log_id']))
{
	// finn logg info
	$log_id = $_base->db->quote($_GET['log_id']);
	$result = $_base->db->query("SELECT ffl_extra FROM ff_log WHERE ffl_id = $log_id AND ffl_ff_id = $ff_id AND ffl_type = 12");
	
	if (mysql_num_rows($result) == 0)
	{
		error("Fant ikke logg enheten.");
	}
	
	$data = mysql_result($result, 0);
	if (empty($data))
	{
		error("Gammel logo finnes ikke.");
	}
	
	$data = base64_decode($data);
	
	// vis logoen
	header("Content-Type: image/png");
	header("X-Script-Time: ".round(microtime(true)-SCRIPT_START, 4));
	echo $data;
	
	die;
}

// hent logo
$result = $_base->db->query("SELECT ff_logo FROM ff WHERE ff_id = $ff_id");

// fant ikke?
if (mysql_num_rows($result) == 0)
{
	error("Fant ikke FF.");
}


// mangler logoen?
$data = mysql_result($result, 0);
if (empty($data))
{
	// bruk standard logo
	$data = base64_decode($unknown_img);
}

// vis logoen
header("Content-Type: image/png");
header("X-Script-Time: ".round(microtime(true)-SCRIPT_START, 4));
echo $data;
